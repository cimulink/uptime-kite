// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Users table
model User {
  id                String     @id @default(uuid())
  name              String
  email             String     @unique
  password_hash     String
  created_at        DateTime   @default(now())
  stripe_customer_id String?
  plan              String     @default("free")
  monitors          Monitor[]
  alert_integrations AlertIntegration[]
}

// Monitors table
model Monitor {
  id                String     @id @default(uuid())
  user_id           String
  user              User       @relation(fields: [user_id], references: [id])
  name              String
  type              MonitorType
  target            String
  interval_seconds  Int
  status            MonitorStatus
  last_checked_at   DateTime?
  created_at        DateTime   @default(now())
  check_results     CheckResult[]
}

// Check Results table
model CheckResult {
  id               BigInt     @id @default(autoincrement())
  monitor_id       String
  monitor          Monitor    @relation(fields: [monitor_id], references: [id])
  status_code      Int?
  response_time_ms Int?
  was_successful   Boolean
  error_message    String?
  checked_at       DateTime   @default(now())
}

// Alert Integrations table
model AlertIntegration {
  id         String  @id @default(uuid())
  user_id    String
  user       User    @relation(fields: [user_id], references: [id])
  type       AlertType
  target     String
  is_verified Boolean @default(false)
}

// Enum for monitor types
enum MonitorType {
  http
  cron
}

// Enum for monitor statuses
enum MonitorStatus {
  up
  down
  pending
  paused
}

// Enum for alert types
enum AlertType {
  sms
  slack
}
